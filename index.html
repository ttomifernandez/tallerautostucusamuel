<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Taller Mec√°nico Samuel - Tucu | Gesti√≥n de Leads Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        :root {
            --primary: #fbbf24;
            --dark: #0f0f0f;
            --surface: #1a1a1a;
        }
        html { scroll-padding-top: 90px; }
        body { font-family: 'Inter', sans-serif; background-color: var(--dark); color: white; overflow-x: hidden; }
        .font-heading { font-family: 'Bebas Neue', sans-serif; }
        .glass-card { background: rgba(26, 26, 26, 0.8); backdrop-filter: blur(12px); border: 1px solid rgba(251, 191, 36, 0.1); }
        .input-field { background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); transition: all 0.3s ease; }
        .input-field:focus { border-color: var(--primary); background: rgba(255, 255, 255, 0.08); outline: none; box-shadow: 0 0 15px rgba(251, 191, 36, 0.2); }
        .btn-primary { background-color: var(--primary); color: black; font-weight: 800; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .btn-primary:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 10px 25px -5px rgba(251, 191, 36, 0.5); filter: brightness(1.1); }
        .bg-grid { background-image: radial-gradient(rgba(251, 191, 36, 0.05) 1px, transparent 1px); background-size: 30px 30px; }
        .hero-gradient { background: linear-gradient(180deg, rgba(15,15,15,0) 0%, rgba(15,15,15,1) 100%); }
        @keyframes pulse-ws { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        .pulse { animation: pulse-ws 2s infinite; }
        .hidden-view { display: none; }
        
        .status-Nuevo { color: #fbbf24; border-color: rgba(251,191,36,0.3); background: rgba(251,191,36,0.05); }
        .status-Contactado { color: #60a5fa; border-color: rgba(96,165,250,0.3); background: rgba(96,165,250,0.05); }
        .status-Presupuestado { color: #a855f7; border-color: rgba(168,85,247,0.3); background: rgba(168,85,247,0.05); }
        .status-Turno { color: #f97316; border-color: rgba(249,115,22,0.3); background: rgba(249,115,22,0.05); }
        .status-Reparacion { color: #14b8a6; border-color: rgba(20,184,166,0.3); background: rgba(20,184,166,0.05); }
        .status-Finalizado { color: #22c55e; border-color: rgba(34,197,94,0.3); background: rgba(34,197,94,0.05); }
        .status-Cancelado { color: #ef4444; border-color: rgba(239,68,68,0.3); background: rgba(239,68,68,0.05); }

        #toast-container { pointer-events: none; }
        .toast { pointer-events: auto; transform: translateY(100px); transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .toast.show { transform: translateY(0); }
    </style>
</head>
<body class="bg-grid">

    <!-- Navbar -->
    <nav class="fixed w-full z-50 px-6 py-4 flex justify-between items-center glass-card border-b border-white/5 transition-all duration-300">
        <div class="flex items-center gap-2 cursor-pointer" onclick="switchView('landing')">
            <div class="bg-amber-400 p-1.5 rounded-lg">
                <i data-lucide="wrench" class="text-black w-6 h-6"></i>
            </div>
            <span class="font-heading text-2xl tracking-wider">SAMUEL <span class="text-amber-400">- TUCU</span></span>
        </div>
        <div class="hidden md:flex gap-8 font-semibold text-sm uppercase tracking-widest text-gray-400 nav-links">
            <a href="#inicio" class="hover:text-amber-400 transition-colors">Inicio</a>
            <a href="#servicios" class="hover:text-amber-400 transition-colors">Servicios</a>
            <a href="#turno" class="hover:text-amber-400 transition-colors">Solicitar Turno</a>
        </div>
        <div class="flex items-center gap-4">
            <button onclick="showAdminModal()" class="text-gray-500 hover:text-amber-400 transition-colors flex items-center gap-2 group">
                <i data-lucide="shield-check" class="w-5 h-5 group-hover:scale-110 transition-transform"></i>
                <span class="hidden md:inline text-[10px] font-bold uppercase tracking-widest">Admin</span>
            </button>
            <a href="tel:3515929043" class="bg-white/5 hover:bg-white/10 px-4 py-2 rounded-full text-xs font-bold border border-white/10 transition-all flex items-center gap-2">
                <i data-lucide="phone" class="w-3 h-3 text-amber-400"></i> <span class="hidden sm:inline">LLAMAR</span>
            </a>
        </div>
    </nav>

    <!-- VISTA: LANDING PAGE -->
    <main id="view-landing">
        <section id="inicio" class="relative min-h-screen flex items-center pt-20 overflow-hidden">
            <div class="absolute inset-0 z-0">
                <img src="https://images.unsplash.com/photo-1486006396123-c775071a357e?auto=format&fit=crop&q=80&w=2000" alt="Taller" class="w-full h-full object-cover opacity-20 grayscale">
                <div class="absolute inset-0 hero-gradient"></div>
            </div>
            <div class="container mx-auto px-6 relative z-10 grid lg:grid-cols-2 gap-12 items-center">
                <div>
                    <span class="inline-block px-4 py-1 rounded-full bg-amber-400/10 text-amber-400 text-xs font-bold tracking-widest mb-6 border border-amber-400/20 uppercase">Mec√°nica Profesional</span>
                    <h1 class="font-heading text-6xl md:text-8xl mb-6 leading-tight uppercase">Diagn√≥stico de <br> <span class="text-amber-400 italic">Alta Gama.</span></h1>
                    <p class="text-gray-400 text-lg md:text-xl max-w-lg mb-10 leading-relaxed">Especialistas en la zona de Circunvalaci√≥n. Solicit√° tu turno online y recib√≠ atenci√≥n prioritaria.</p>
                    <a href="#turno" class="btn-primary px-10 py-5 rounded-2xl inline-flex items-center gap-4 text-lg">RESERVAR TURNO ONLINE <i data-lucide="calendar-plus" class="w-6 h-6"></i></a>
                </div>
            </div>
        </section>

        <!-- Formulario -->
        <section id="turno" class="py-24 relative overflow-hidden">
            <div class="container mx-auto px-6 max-w-4xl">
                <div class="glass-card p-8 md:p-12 rounded-[40px] relative z-10">
                    <h2 class="font-heading text-4xl mb-8 uppercase tracking-wider italic">Solicitud de Servicio</h2>
                    <form id="contactForm" class="grid md:grid-cols-2 gap-6">
                        <input type="text" id="nombre" required placeholder="Nombre Completo" class="p-4 rounded-xl input-field text-white text-sm">
                        <input type="tel" id="telefono" required placeholder="WhatsApp (Ej: 351...)" class="p-4 rounded-xl input-field text-white text-sm">
                        <input type="text" id="vehiculo" required placeholder="Marca y Modelo" class="p-4 rounded-xl input-field text-white text-sm">
                        <input type="number" id="anio" required placeholder="A√±o del Veh√≠culo" class="p-4 rounded-xl input-field text-white text-sm">
                        <textarea id="falla" required rows="3" placeholder="Describe la falla que presenta..." class="md:col-span-2 p-4 rounded-xl input-field text-white text-sm resize-none"></textarea>
                        <button type="button" id="submitBtn" onclick="processSubmission()" class="md:col-span-2 btn-primary py-5 rounded-2xl flex items-center justify-center gap-4 text-lg uppercase tracking-wider">
                            ENVIAR Y AGENDAR <i data-lucide="send" class="w-6 h-6"></i>
                        </button>
                    </form>
                </div>
            </div>
        </section>

        <!-- Ubicaci√≥n -->
        <section id="ubicacion" class="py-24 bg-[#0a0a0a] text-center border-t border-white/5">
            <div class="container mx-auto px-6 max-w-4xl">
                <h2 class="font-heading text-5xl mb-4 uppercase">Ubicaci√≥n</h2>
                <div class="glass-card p-10 rounded-[40px] relative overflow-hidden">
                    <div class="relative z-10">
                        <p class="text-amber-400 font-bold text-xl mb-2 uppercase tracking-tight">Cabo Alfredo Alejandro Gonzalez 1547</p>
                        <p class="text-gray-300 mb-2 font-medium">Esquina R√≠o Coyle y Cincinnati</p>
                        <p class="text-gray-500 mb-8 uppercase tracking-widest text-[10px] font-bold">A metros de Av. Circunvalaci√≥n Agust√≠n Tosco ‚Ä¢ C√≥rdoba</p>
                        <a href="https://maps.app.goo.gl/5MdzmPvMxeats4Zs9" target="_blank" class="btn-primary px-10 py-4 rounded-xl inline-flex items-center justify-center gap-3">
                            <i data-lucide="navigation" class="w-5 h-5"></i>
                            C√ìMO LLEGAR
                        </a>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- VISTA: PANEL ADMIN -->
    <main id="view-admin" class="hidden-view pt-32 pb-24 container mx-auto px-6">
        <div class="flex flex-col md:flex-row justify-between items-start md:items-end mb-12 gap-6">
            <div>
                <h2 class="font-heading text-6xl uppercase tracking-tighter">Panel de <span class="text-amber-400">Leads</span></h2>
                <p class="text-gray-500 font-bold text-xs uppercase tracking-widest mt-2">Gesti√≥n de clientes en tiempo real</p>
            </div>
            <div class="flex gap-4">
                <button onclick="switchView('landing')" class="bg-white/5 p-4 rounded-2xl hover:bg-white/10 border border-white/10 transition-all text-gray-400">
                    <i data-lucide="home" class="w-6 h-6"></i>
                </button>
                <button onclick="fetchContacts()" class="bg-white/5 p-4 rounded-2xl hover:bg-white/10 border border-white/10 transition-all">
                    <i data-lucide="refresh-cw" class="w-6 h-6 text-amber-400" id="refresh-icon"></i>
                </button>
            </div>
        </div>

        <div class="glass-card rounded-3xl overflow-hidden border border-white/5">
            <div class="overflow-x-auto">
                <table class="w-full text-left border-collapse min-w-[800px]">
                    <thead>
                        <tr class="bg-white/5 text-gray-500 font-bold text-[10px] uppercase tracking-[0.2em]">
                            <th class="p-6">Fecha</th>
                            <th class="p-6">Cliente</th>
                            <th class="p-6">Veh√≠culo</th>
                            <th class="p-6">Falla</th>
                            <th class="p-6">Estado</th>
                            <th class="p-6">Chat</th>
                        </tr>
                    </thead>
                    <tbody id="admin-table-body" class="text-sm divide-y divide-white/5">
                        <tr><td colspan="6" class="p-20 text-center text-gray-500 italic">Cargando base de datos...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <div id="admin-error-debug" class="mt-8 p-4 rounded-xl bg-red-500/10 border border-red-500/20 text-red-500 text-xs hidden"></div>
    </main>

    <!-- Modal de Administraci√≥n -->
    <div id="admin-modal" class="fixed inset-0 z-[60] hidden flex items-center justify-center px-6">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" onclick="closeAdminModal()"></div>
        <div class="glass-card w-full max-w-md p-10 rounded-[32px] relative z-10 border-amber-400/20">
            <h3 class="font-heading text-4xl mb-6 text-center">Acceso Privado</h3>
            <input type="password" id="admin-pass-input" placeholder="Contrase√±a" class="w-full p-4 rounded-xl input-field text-white text-center mb-6 focus:ring-2 ring-amber-400/20">
            <div class="grid grid-cols-2 gap-4">
                <button onclick="closeAdminModal()" class="py-4 rounded-xl bg-white/5 hover:bg-white/10 font-bold text-xs uppercase tracking-widest transition-all">Cancelar</button>
                <button onclick="verifyAdminPass()" class="py-4 rounded-xl btn-primary uppercase text-xs tracking-widest">Entrar</button>
            </div>
        </div>
    </div>

    <div id="toast-container" class="fixed bottom-10 left-1/2 -translate-x-1/2 z-[100] space-y-4"></div>

    <footer class="py-12 border-t border-white/5 bg-[#080808] text-center text-gray-600 text-[10px] uppercase tracking-[0.4em]">
        ¬© 2024 Taller Samuel - C√≥rdoba
    </footer>

    <script>
        lucide.createIcons();

        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyndACTC8jyEUgHbX7C6Sl1GAQEebof6PKFiKrrjPHGNSF6KwglSaUVMrQ7PZuktKSw/exec"; 
        const ADMIN_PASS = "samuel2024";

        function showToast(message, type = 'success') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast glass-card px-8 py-4 rounded-2xl border-white/10 shadow-2xl flex items-center gap-4 text-sm font-semibold whitespace-nowrap`;
            const color = type === 'success' ? 'text-green-500' : 'text-red-500';
            const icon = type === 'success' ? 'check-circle' : 'alert-circle';
            toast.innerHTML = `<i data-lucide="${icon}" class="${color} w-5 h-5"></i> ${message}`;
            container.appendChild(toast);
            lucide.createIcons();
            setTimeout(() => toast.classList.add('show'), 100);
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 500);
            }, 4000);
        }

        function switchView(view) {
            const landing = document.getElementById('view-landing');
            const admin = document.getElementById('view-admin');
            const navLinks = document.querySelector('.nav-links');
            if (view === 'admin') {
                landing.classList.add('hidden-view');
                admin.classList.remove('hidden-view');
                navLinks.classList.add('invisible');
                fetchContacts();
            } else {
                landing.classList.remove('hidden-view');
                admin.classList.add('hidden-view');
                navLinks.classList.remove('invisible');
            }
            window.scrollTo(0,0);
        }

        function showAdminModal() {
            document.getElementById('admin-modal').classList.remove('hidden');
            document.getElementById('admin-pass-input').focus();
        }

        function closeAdminModal() {
            document.getElementById('admin-modal').classList.add('hidden');
            document.getElementById('admin-pass-input').value = '';
        }

        function verifyAdminPass() {
            const input = document.getElementById('admin-pass-input');
            if (input.value === ADMIN_PASS) {
                closeAdminModal();
                switchView('admin');
                showToast("Acceso concedido");
            } else {
                showToast("Contrase√±a incorrecta", "error");
                input.value = '';
            }
        }

        document.getElementById('admin-pass-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') verifyAdminPass();
        });

        async function processSubmission() {
            const nombre = document.getElementById('nombre').value;
            const telefono = document.getElementById('telefono').value;
            const vehiculo = document.getElementById('vehiculo').value;
            const anio = document.getElementById('anio').value;
            const falla = document.getElementById('falla').value;
            const btn = document.getElementById('submitBtn');

            if (!nombre || !telefono || !vehiculo || !falla) {
                showToast("Completa todos los campos", "error");
                return;
            }

            btn.disabled = true;
            btn.innerHTML = `<span>ENVIANDO...</span>`;

            try {
                const formData = new FormData();
                formData.append('action', 'add');
                formData.append('nombre', nombre);
                formData.append('telefono', telefono);
                formData.append('vehiculo', vehiculo);
                formData.append('anio', anio);
                formData.append('falla', falla);
                formData.append('estado', 'Nuevo');
                formData.append('fecha', new Date().toLocaleString('es-AR'));
                
                await fetch(SCRIPT_URL, { method: 'POST', body: formData });
                showToast("Datos registrados correctamente");
            } catch (e) { console.error("Error al enviar:", e); }

            const message = `*NUEVO TURNO*%0Aüë§ *CLIENTE:* ${nombre}%0Aüöó *AUTO:* ${vehiculo} (${anio})%0A‚ö†Ô∏è *FALLA:* ${falla}`;
            window.open(`https://wa.me/5493515929043?text=${message}`, '_blank');
            
            btn.disabled = false;
            btn.innerHTML = `ENVIAR Y AGENDAR`;
            document.getElementById('contactForm').reset();
        }

        async function fetchContacts() {
            const tableBody = document.getElementById('admin-table-body');
            const refreshIcon = document.getElementById('refresh-icon');
            const debugDiv = document.getElementById('admin-error-debug');
            
            tableBody.innerHTML = `<tr><td colspan="6" class="p-20 text-center text-gray-500 italic">Cargando base de datos...</td></tr>`;
            debugDiv.classList.add('hidden');
            refreshIcon.classList.add('animate-spin');
            
            try {
                const response = await fetch(SCRIPT_URL + "?t=" + Date.now(), {
                    method: 'GET',
                    redirect: 'follow'
                });

                if (!response.ok) throw new Error(`HTTP Error: ${response.status}`);

                const data = await response.json();
                
                if (data.length === 0) {
                    tableBody.innerHTML = `<tr><td colspan="6" class="p-20 text-center text-gray-500 italic">No hay leads registrados a√∫n.</td></tr>`;
                } else {
                    tableBody.innerHTML = data.map((contact, index) => {
                        const realRowIndex = data.length - index + 1; 
                        const statuses = ["Nuevo", "Contactado", "Presupuestado", "Turno", "Reparacion", "Finalizado", "Cancelado"];
                        const options = statuses.map(s => `<option value="${s}" ${contact.estado === s ? 'selected' : ''}>${s}</option>`).join('');

                        // FIX: Forzamos el telefono a String antes de limpiar caracteres
                        const telStr = String(contact.telefono || "").replace(/\D/g,'');

                        return `
                            <tr class="hover:bg-white/[0.02] transition-colors border-b border-white/5 last:border-0">
                                <td class="p-6 text-gray-500 font-mono text-[10px] whitespace-nowrap">${contact.fecha || '-'}</td>
                                <td class="p-6">
                                    <p class="font-bold text-white text-base">${contact.nombre || "Sin nombre"}</p>
                                    <p class="text-amber-400 text-xs">${contact.telefono || "Sin tel"}</p>
                                </td>
                                <td class="p-6">
                                    <p class="text-gray-300 font-semibold">${contact.vehiculo || "-"}</p>
                                    <p class="text-gray-600 text-xs">${contact.anio || ""}</p>
                                </td>
                                <td class="p-6 text-gray-400 max-w-xs truncate" title="${contact.falla}">${contact.falla || "-"}</td>
                                <td class="p-6">
                                    <select onchange="updateStatus(${realRowIndex}, this.value)" 
                                        class="bg-transparent border border-white/10 rounded-lg px-2 py-1 text-xs font-bold status-${contact.estado} outline-none cursor-pointer">
                                        ${options}
                                    </select>
                                </td>
                                <td class="p-6 text-center">
                                    <a href="https://wa.me/549${telStr}" target="_blank" class="w-10 h-10 rounded-full bg-green-500/10 flex items-center justify-center text-green-500 hover:bg-green-500 hover:text-white transition-all mx-auto">
                                        <i data-lucide="message-circle" class="w-5 h-5"></i>
                                    </a>
                                </td>
                            </tr>
                        `;
                    }).join('');
                }
                lucide.createIcons();
            } catch (e) {
                console.error("Error al cargar:", e);
                tableBody.innerHTML = `<tr><td colspan="6" class="p-20 text-center text-red-500">Error al cargar datos. Verifica la conexi√≥n o permisos del script.</td></tr>`;
                debugDiv.innerText = `DEBUG: ${e.message}`;
                debugDiv.classList.remove('hidden');
            } finally {
                refreshIcon.classList.remove('animate-spin');
            }
        }

        async function updateStatus(rowIndex, newStatus) {
            try {
                const formData = new FormData();
                formData.append('action', 'update');
                formData.append('rowIndex', rowIndex);
                formData.append('status', newStatus);
                await fetch(SCRIPT_URL, { method: 'POST', body: formData });
                showToast(`Estado: ${newStatus}`);
                fetchContacts();
            } catch (e) { 
                console.error(e);
                showToast("Error al actualizar", "error");
            }
        }

        window.addEventListener('scroll', () => {
            const nav = document.querySelector('nav');
            window.scrollY > 50 ? nav.classList.add('py-2', 'bg-black/95') : nav.classList.remove('py-2', 'bg-black/95');
        });
    </script>
</body>
</html>
